<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–æ—Ö–∞–Ω–Ω—è</title>
  <link rel="icon" type="image/png" href="icon.png" />
  <link rel="stylesheet" href="index.css" />
</head>
<body>

  <!-- ‚îÄ‚îÄ Ambient layers ‚îÄ‚îÄ -->
  <div class="aurora"></div>
  <div class="aurora-2"></div>
  <div class="moon"></div>
  <canvas id="starCanvas"></canvas>

  <!-- ‚îÄ‚îÄ Note musicali ‚îÄ‚îÄ -->
  <div class="music-note" style="left:8%;  animation-duration:16s; animation-delay:0s;   color:#ce93d8; font-size:20px;">‚ô™</div>
  <div class="music-note" style="left:28%; animation-duration:20s; animation-delay:-5s;  color:#b39ddb; font-size:16px;">‚ô´</div>
  <div class="music-note" style="left:52%; animation-duration:14s; animation-delay:-10s; color:#f48fb1; font-size:22px;">‚ô©</div>
  <div class="music-note" style="left:75%; animation-duration:18s; animation-delay:-3s;  color:#ce93d8; font-size:18px;">‚ô¨</div>
  <div class="music-note" style="left:92%; animation-duration:22s; animation-delay:-8s;  color:#80cbc4; font-size:16px;">‚ô™</div>

  <!-- ‚îÄ‚îÄ Floating hearts ‚îÄ‚îÄ -->
  <div class="heart-float" style="left:18%; animation-duration:24s; animation-delay:-6s;  font-size:14px;">üíú</div>
  <div class="heart-float" style="left:80%; animation-duration:20s; animation-delay:-14s; font-size:12px;">‚ú®</div>

  <!-- ‚îÄ‚îÄ Fireflies ‚îÄ‚îÄ -->
  <div class="firefly" style="top:35%; left:6%;  background:#ce93d8; box-shadow:0 0 8px 4px rgba(206,147,216,0.6); animation-duration:3s;"></div>
  <div class="firefly" style="top:58%; left:92%; background:#80cbc4; box-shadow:0 0 8px 4px rgba(128,203,196,0.6); animation-duration:4s;   animation-delay:-1.5s;"></div>
  <div class="firefly" style="top:78%; left:50%; background:#ffe082; box-shadow:0 0 8px 4px rgba(255,224,130,0.6); animation-duration:3.5s; animation-delay:-2s;"></div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       CONTENT
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="container">

    <!-- Il canvas parte dal top, sfondo nero del video = sfondo body -->
    <div class="video-wrapper">
      <div class="raccoon-wrap">
        <canvas id="raccoonCanvas"></canvas>
      </div>
    </div>

    <div class="divider"></div>

    <div class="verse-section">
      <p class="intro-text">
        –¢–∏ –º–µ–Ω–µ, –Ω–∞–ø–µ–≤–Ω–æ, –≤–∂–µ –∑–Ω–∞—î—à,<br />
        –ê –º–æ–∂–µ, –º–∏ –¥–µ—Å—å –∑—É—Å—Ç—Ä—ñ—á–∞–ª–∏—Å—å.<br />
        –•–∞–π –ø—ñ—Å–Ω—è —Ü—è —Ç–∏—Ö–æ –ª—É–Ω–∞—î,<br />
        –Ø–∫ –º–∏—Ç—ñ, –¥–µ –º–∏ —Å–ø—ñ–ª–∫—É–≤–∞–ª–∏—Å—å.
      </p>
    </div>

    <div class="verse-section">
      <p class="intro-text">
        –Ø ‚Äî —Ç–æ–π —Å–∞–º–∏–π —î–Ω–æ—Ç, —â–æ –ª–∏—à–∏–≤—Å—è –≤–Ω–æ—á—ñ,<br />
        –Ü –º—ñ–π —Ç–∏—Ö–∏–π —à–µ–ø—ñ—Ç –Ω–µ –∑–Ω–∞—î –∫—ñ–Ω—Ü—è.<br />
        –£ –º–µ–Ω–µ —Ç—É—Ç —Ç–µ–º—Ä—è–≤–∞ –π –∑–æ—Ä—ñ-—Å–≤—ñ—á—ñ,<br />
        –ê –≤ —Ç–µ–±–µ –≤–∂–µ —Å–æ–Ω—Ü–µ —Ç–æ—Ä–∫–∞—î –ª–∏—Ü—è.
      </p>
    </div>

    <div class="verse-section">
      <p class="intro-text">
        –¢–∏ –ø—Ä–æ–π—à–ª–∞ –∫—Ä—ñ–∑—å —Å—Ç–æ—Ä—ñ–Ω–∫–∏, –µ–º–æ—Ü—ñ—ó, –¥–Ω—ñ,<br />
        –ó–∞–ª–∏—à–∏–≤—à–∏ —Å—É–º, —â–æ –∑–≤—É—á–∏—Ç—å –≤—Å–µ —Ç–∏—Ö—ñ—à–µ.<br />
        –¶—ñ –≥—ñ—Ç–∞—Ä–Ω—ñ –º–æ—Ç–∏–≤–∏ —Ä–æ–∑—Ç–∞–Ω—É—Ç—å —É —Å–Ω—ñ,<br />
        –ë–æ –≤—Å–µ, —â–æ –ø–æ–ø–µ—Ä–µ–¥—É –±—É–¥–µ –∑–Ω–∞—á–Ω–æ —Å–≤—ñ—Ç–ª—ñ—à–µ.
      </p>
    </div>

    <div class="verse-section">
      <p class="intro-text">
        –Ü –∑–Ω–∞—î—à —â–æ? –Ø —Ü–µ –≤–∂–µ –≤—ñ–¥—á—É–≤–∞—é:<br />
        –ù–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–∞–∑—É —Ç–∏ —Ç–æ—á–Ω–æ –∑–Ω–∞–π–¥–µ—à<br />
        –Ñ–¥–∏–Ω–∏–π —Å–≤—ñ—Ç–∞–Ω–æ–∫, –¥–µ —Å–æ–Ω—Ü–µ —Å—Ç—Ä—ñ—á–∞—é—Ç—å,<br />
        –Ü —Å–ø—ñ–ª—å–Ω—É –¥–æ—Ä–æ–≥—É, —è–∫–æ—é –ø—ñ–¥–µ—à.
      </p>
    </div>

    <div class="divider"></div>

    <p class="intro-text">–ß–∏ –≥–æ—Ç–æ–≤–∞ —Ç–∏ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Å—è –∫–æ—Ö–∞–Ω–Ω—é?</p>

    <button class="love-btn" id="loveButton" onclick="showTask()">–ö–æ—Ö–∞—Ç–∏</button>

    <div class="task" id="taskBlock">
      <div class="heart-hold-wrap">
        <svg class="heart-progress-ring" viewBox="0 0 120 120">
          <circle class="ring-bg"   cx="60" cy="60" r="52" />
          <circle class="ring-fill" cx="60" cy="60" r="52" id="ringFill" />
        </svg>
        <div class="heart-btn" id="heartBtn">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 90" width="52" height="52">
            <defs>
              <radialGradient id="hg" cx="50%" cy="40%" r="60%">
                <stop offset="0%"   stop-color="#fff4c2" />
                <stop offset="45%"  stop-color="#ffd060" />
                <stop offset="100%" stop-color="#e8940a" />
              </radialGradient>
            </defs>
            <path d="M50 82 C50 82 8 54 8 28 C8 14 19 5 30 5 C38 5 45 10 50 17
                     C55 10 62 5 70 5 C81 5 92 14 92 28 C92 54 50 82 50 82Z"
                  fill="url(#hg)" stroke="rgba(255,220,80,0.35)" stroke-width="1.5" />
          </svg>
        </div>
      </div>
      <p id="loveMessage"></p>
    </div>

  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SCRIPTS
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

  <!-- 1. Heart interaction -->
  <script>
    function showTask() {
      document.getElementById('loveButton').style.display = 'none';
      document.getElementById('taskBlock').style.display  = 'block';
      initHeartHold();
    }

    function initHeartHold() {
      const btn    = document.getElementById('heartBtn');
      const ring   = document.getElementById('ringFill');
      const msg    = document.getElementById('loveMessage');
      const TOTAL  = 3000;
      const CIRCUM = 2 * Math.PI * 52;
      ring.style.strokeDasharray  = CIRCUM;
      ring.style.strokeDashoffset = CIRCUM;

      const quips = [
        '–Ñ–Ω–æ—Ç –¥–∏–≤–∏—Ç—å—Å—è –Ω–∞ —Ç–µ–±–µ –∑ –Ω—ñ–∂–Ω—ñ—Å—Ç—é —Ä–æ–∑–º—ñ—Ä–æ–º —ñ–∑ –≥–∞–ª–∞–∫—Ç–∏–∫—É',
        '–Ñ–Ω–æ—Ç –≤—ñ–¥—á—É–≤–∞—î —Ç–µ–ø–ª–æ...'
      ];

      let quipIdx = 0, quipTimer = null;
      let startTime = null, rafId = null, holding = false;

      function startHold(e) {
        e.preventDefault();
        if (holding) return;
        holding = true; startTime = performance.now();
        btn.classList.add('holding');
        msg.textContent = ''; msg.classList.remove('sad');
        scheduleQuip();
        rafId = requestAnimationFrame(tick);
      }
      function scheduleQuip() {
        if (quipIdx >= quips.length) return;
        quipTimer = setTimeout(() => {
          if (!holding) return;
          msg.style.color = 'rgba(255,230,150,0.88)';
          msg.textContent  = quips[quipIdx];
          quipIdx++;
          scheduleQuip();
        }, quipIdx === 0 ? 500 : 1400);
      }
      function tick(now) {
        if (!holding) return;
        const p = Math.min((now - startTime) / TOTAL, 1);
        ring.style.strokeDashoffset = CIRCUM * (1 - p);
        btn.style.transform = `scale(${1 + p * 0.35})`;
        if (p >= 1) { finish(); return; }
        rafId = requestAnimationFrame(tick);
      }
      function stopHold() {
        if (!holding) return;
        holding = false;
        clearTimeout(quipTimer); cancelAnimationFrame(rafId);
        btn.classList.remove('holding');
        btn.style.transform = '';
        ring.style.strokeDashoffset = CIRCUM;
        quipIdx = 0;
        msg.classList.add('sad'); msg.style.color = '';
        msg.textContent = '–Ñ–Ω–æ—Ç –∑–∞—Å–º—É—Ç–∏–≤—Å—è... —Å–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑';
        setTimeout(() => { if (!holding) { msg.textContent = ''; msg.classList.remove('sad'); } }, 2200);
      }
      function finish() {
        holding = false; clearTimeout(quipTimer);
        btn.classList.remove('holding'); btn.classList.add('done');
        msg.style.color = 'rgba(255,250,220,0.95)';
        msg.textContent = '–í–∏ —Ç–µ–∂ —á—É—î—Ç–µ —Ü–µ —Å–µ—Ä—Ü–µ–±–∏—Ç—Ç—è?';
        setTimeout(() => { window.location.href = 'raccoon.html'; }, 1200);
      }

      btn.addEventListener('mousedown',   startHold);
      btn.addEventListener('touchstart',  startHold, { passive: false });
      btn.addEventListener('mouseup',     stopHold);
      btn.addEventListener('mouseleave',  stopHold);
      btn.addEventListener('touchend',    stopHold);
      btn.addEventListener('touchcancel', stopHold);
    }
  </script>

  <!-- 2. Video procione ‚Üí canvas (sfondo nero, nessuna rimozione pixel necessaria) -->
  <script>
  (function () {
    const canvas = document.getElementById('raccoonCanvas');
    const ctx    = canvas.getContext('2d');

    // Video nascosto con opacity 0.01 (permette autoplay nei browser)
    const video = document.createElement('video');
    video.setAttribute('loop', '');
    video.setAttribute('muted', '');
    video.setAttribute('autoplay', '');
    video.setAttribute('playsinline', '');
    video.muted    = true;   // propriet√† JS ‚Äî necessaria per autoplay su Chrome/Safari
    video.autoplay = true;
    video.loop     = true;
    video.style.cssText = 'position:fixed;left:-9999px;top:0;width:2px;height:2px;opacity:0.01;pointer-events:none;';
    document.body.appendChild(video);

    const source = document.createElement('source');
    source.src  = 'videos/dance.mp4';
    video.setAttribute('preload', 'auto');
    source.type = 'video/mp4';
    video.appendChild(source);

    // Dimensioni iniziali ‚Äî aggiornate quando il video carica
    canvas.width  = 400;
    canvas.height = 400;

    let running = false;

    // Canvas offscreen per il vignette (evita allocazione ogni frame)
    let vignCanvas = null, vignCtx = null;

    function buildVignette(w, h) {
      vignCanvas = document.createElement('canvas');
      vignCanvas.width  = w;
      vignCanvas.height = h;
      vignCtx = vignCanvas.getContext('2d');

      // Layer 1: gradiente radiale ‚Äî sfuma lati e angoli
      const cx = w / 2, cy = h / 2;
      const grad = vignCtx.createRadialGradient(cx, cy, 0, cx, cy, Math.max(cx, cy));
      grad.addColorStop(0.00, 'rgba(0,0,0,0)');
      grad.addColorStop(0.40, 'rgba(0,0,0,0)');
      grad.addColorStop(0.58, 'rgba(0,0,0,0.15)');
      grad.addColorStop(0.72, 'rgba(0,0,0,0.55)');
      grad.addColorStop(0.85, 'rgba(0,0,0,0.88)');
      grad.addColorStop(1.00, 'rgba(0,0,0,1)');
      vignCtx.fillStyle = grad;
      vignCtx.fillRect(0, 0, w, h);

      // Layer 2: gradiente lineare dal basso ‚Äî copre il bordo inferiore (il pi√π visibile)
      const gradBottom = vignCtx.createLinearGradient(0, h * 0.52, 0, h);
      gradBottom.addColorStop(0.00, 'rgba(0,0,0,0)');
      gradBottom.addColorStop(0.35, 'rgba(0,0,0,0.35)');
      gradBottom.addColorStop(0.65, 'rgba(0,0,0,0.80)');
      gradBottom.addColorStop(1.00, 'rgba(0,0,0,1)');
      vignCtx.fillStyle = gradBottom;
      vignCtx.fillRect(0, 0, w, h);

      // Layer 3: gradiente lineare dall'alto ‚Äî sfuma il top (pi√π esteso)
      const gradTop = vignCtx.createLinearGradient(0, 0, 0, h * 0.30);
      gradTop.addColorStop(0.00, 'rgba(0,0,0,1)');
      gradTop.addColorStop(0.30, 'rgba(0,0,0,0.70)');
      gradTop.addColorStop(0.70, 'rgba(0,0,0,0.20)');
      gradTop.addColorStop(1.00, 'rgba(0,0,0,0)');
      vignCtx.fillStyle = gradTop;
      vignCtx.fillRect(0, 0, w, h);

      // Layer 4: gradiente laterale sinistro
      const gradLeft = vignCtx.createLinearGradient(0, 0, w * 0.18, 0);
      gradLeft.addColorStop(0.00, 'rgba(0,0,0,0.85)');
      gradLeft.addColorStop(1.00, 'rgba(0,0,0,0)');
      vignCtx.fillStyle = gradLeft;
      vignCtx.fillRect(0, 0, w, h);

      // Layer 5: gradiente laterale destro
      const gradRight = vignCtx.createLinearGradient(w * 0.82, 0, w, 0);
      gradRight.addColorStop(0.00, 'rgba(0,0,0,0)');
      gradRight.addColorStop(1.00, 'rgba(0,0,0,0.85)');
      vignCtx.fillStyle = gradRight;
      vignCtx.fillRect(0, 0, w, h);
    }

    function frame() {
      if (video.readyState >= 2 && video.videoWidth > 0) {
        const vw = video.videoWidth;
        const vh = video.videoHeight;

        // Frame intero senza crop ‚Äî mostra tutto il procione
        if (canvas.width !== vw || canvas.height !== vh) {
          canvas.width  = vw;
          canvas.height = vh;
          buildVignette(vw, vh);   // ricalcola vignette quando cambiano le dimensioni
        }

        // 1. Disegna il frame video
        ctx.drawImage(video, 0, 0, vw, vh, 0, 0, vw, vh);

        // 2. Applica vignette: destination-out cancella i pixel ai bordi (alpha ‚Üí 0)
        ctx.globalCompositeOperation = 'destination-out';
        ctx.drawImage(vignCanvas, 0, 0);
        ctx.globalCompositeOperation = 'source-over';
      }
      requestAnimationFrame(frame);
    }

    function start() {
      if (running) return;
      running = true;
      video.play().catch(() => {});
      frame();
    }

    video.addEventListener('loadedmetadata', start, { once: true });
    video.load();
    setTimeout(start, 500);

    // Fallback: primo gesto utente sblocca autoplay
    ['click', 'touchstart', 'keydown'].forEach(ev =>
      document.addEventListener(ev, () => {
        video.play().catch(() => {});
        if (!running) start();
      }, { once: true })
    );
  })();
  </script>

  <!-- 3. Stelle + stelle cadenti -->
  <script>
  (function () {
    const canvas = document.getElementById('starCanvas');
    const ctx    = canvas.getContext('2d');

    function resize() {
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    const COLORS = ['#ffffff','#e8d5f5','#ce93d8','#b39ddb','#9c88d4','#d4a8f0'];

    const stars = Array.from({ length: 300 }, () => ({
      x:     Math.random() * window.innerWidth,
      y:     Math.random() * window.innerHeight,
      r:     Math.random() * 1.4 + 0.2,
      speed: Math.random() * 0.5 + 0.08,
      phase: Math.random() * Math.PI * 2,
      color: COLORS[Math.floor(Math.random() * COLORS.length)]
    }));

    const shooters = Array.from({ length: 3 }, createShooter);
    function createShooter() {
      return {
        x:       Math.random() * canvas.width  * 0.7,
        y:       Math.random() * canvas.height * 0.4,
        len:     Math.random() * 130 + 70,
        speed:   Math.random() * 6 + 4,
        opacity: 0, fade: 'in',
        delay:   Math.random() * 9000
      };
    }
    function drawShooter(s, t) {
      if (t < s.delay) return;
      if (s.fade === 'in')   s.opacity = Math.min(s.opacity + 0.04, 1);
      if (s.opacity >= 1)    s.fade = 'move';
      if (s.fade === 'move') { s.x += s.speed; s.y += s.speed * 0.5; s.opacity -= 0.018; }
      if (s.opacity <= 0) { Object.assign(s, createShooter()); s.delay = t + Math.random()*7000+2000; return; }
      const ang = Math.atan2(s.speed * 0.5, s.speed);
      const x2  = s.x - Math.cos(ang) * s.len;
      const y2  = s.y - Math.sin(ang) * s.len;
      const grd = ctx.createLinearGradient(s.x, s.y, x2, y2);
      grd.addColorStop(0,   `rgba(255,255,255,${s.opacity})`);
      grd.addColorStop(0.4, `rgba(200,170,255,${s.opacity * 0.6})`);
      grd.addColorStop(1,   'rgba(255,255,255,0)');
      ctx.beginPath(); ctx.moveTo(s.x, s.y); ctx.lineTo(x2, y2);
      ctx.strokeStyle = grd; ctx.lineWidth = 1.8;
      ctx.globalAlpha = s.opacity; ctx.stroke(); ctx.globalAlpha = 1;
    }

    function draw(t) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      stars.forEach(s => {
        // Le stelle in cima sono pi√π visibili (sfondo nero puro)
        const baseOpacity = s.y < canvas.height * 0.3 ? 0.5 : 0.25;
        const opacity = baseOpacity + 0.5 * Math.abs(Math.sin(t * s.speed * 0.0008 + s.phase));
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fillStyle   = s.color;
        ctx.globalAlpha = opacity;
        ctx.fill();
      });
      ctx.globalAlpha = 1;
      shooters.forEach(s => drawShooter(s, t));
      requestAnimationFrame(draw);
    }
    requestAnimationFrame(draw);
  })();
  </script>

</body>
</html>